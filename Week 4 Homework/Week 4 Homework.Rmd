---
title: "Week 4 Homework"
author: "Christy Choi"
date: "2025-10-26"
output: html_document
---

# Exam

The task this week is to:

-   Read in [global gender inequality data](https://hdr.undp.org/data-center/documentation-and-downloads)

-   Join the global gender inequality index to [spatial data of the World](https://hub.arcgis.com/datasets/2b93b06dc0dc4e809d3c8db5cb96ba69_0/explore?location=-2.688200%2C0.000000%2C1.41), creating a new column of difference in inequality between 2010 and 2019. **Note** this download has become temperamental but the .geojson should work. Andy will provide the data if not.

-   Share it with the World on GitHub

-   Add you repository URL to the circulated spreadsheet

**Tip** the [countrycode R package](https://github.com/vincentarelbundock/countrycode) will be helpful!

**Tip** the gender inequality has changed in the last year, you will find what you need in the “All composite indices and components time series (1990-2021)” dataset, the metadata file beneath it will explain what the columns are.

## Plan:

1.  Read in Gender Inequality Index (GII)
2.  Read in World Countries Spatial Layer
3.  Clean and match country identifiers (Use countrycode package)
4.  Join GII with World and compute changes between 2010 and 2019

## Clear Memory First!!

```{r}
rm(list = ls()) #removes all objects from workspace
gc() #clear memory
```

## Install Packages

```{r}
library(sf)
library(readr)
library(here)
library(tidyverse)
library(janitor)
library(ggplot2)
library(countrycode)
```

## 1. Read in GII Data

```{r}
GIIdata <- read_csv(
  "HDR25_Composite_indices_complete_time_series.csv")
print(GIIdata)
```

## 2. Read in Spatial Data

```{r}
WorldCities <- st_read(
  here::here("Week 4 Homework",
  "World_Countries_(Generalized)_-573431906301700955",
  "World_Countries_Generalized.shp"))
```

## 3. Clean Data and Create a New Column of Difference in Inequality between 2010 and 2019

1.  Clean Names
2.  Select columns we want
3.  Mutate a new column for calculated difference

```{r}
GIIdata_clean <- GIIdata %>%
  janitor::clean_names() %>%
  select(iso3, country, gii_2010, gii_2019) %>%
  mutate(
    gii_2010 = as.numeric(gii_2010),
    gii_2019 = as.numeric(gii_2019),
    gii_difference = gii_2019 - gii_2010
  ) %>%
  filter(!is.na(iso3), !is.na(gii_difference))
```

GIIdata_clean \<- GIIdata %\>% janitor::clean_names()%\>% select(iso3, country, gii_2010, gii_2019)%\>% mutate(GIIdiff = gii_2019 - gii_2010)

## 4. Convert to ISO to ISO3 for WorldCities file

-   Add a new column named iso_code for converted ISO

-   Using the countrycode package:

    -   Choose ISO as the vector to be converted,

    -   origin ="iso2c" tells R that the format is 2-character country codes (e.g. US, CN)

    -   destination ="iso3c" tells R that we want a 3-character country code out (same as our GIIdata_clean)

```{r}
WorldCitiesiso3 <- WorldCities%>%
  mutate(iso_code = countrycode(ISO, origin= "iso2c", destination="iso3c"))
```

## Join Data (using left-join)

-   Join WorldCitiesiso3 and GIIdata_clean!!!

-   Remove all NA values

-   Select the columns we need: Country, iso_code, GIIdiff and geometry

```{r}
joindata <- WorldCitiesiso3%>%
  left_join(.,
            GIIdata_clean, 
            by= c("iso_code"= "iso3", "COUNTRY"="country"))%>%
  drop_na() %>%
  select(c(1,5,8,9))%>%
  mutate(across(where(is.numeric), round, 2))
  #round all numeric values to 2 decimal places
```

## Plot

Load tmap package first:

```{r}
library(tmap)
```

```{r}
joindata <- joindata %>%
  st_transform(.,4326)

tmap_mode("view")
```

```{r}
tm_shape(joindata) + 
  # add polygon layer
  tm_polygons(fill="gii_difference",
              fill.scale= tm_scale_intervals(values="brewer.bu_pu",
                                              style="jenks"),
                                              fill_alpha=0.5,
              fill.legend = tm_legend(title = "Gender Inequality Index", 
                                      size = 0.8))+
  tm_basemap(server = "OpenStreetMap") +
  tm_compass(type = "arrow", position = c("left", "bottom")) + 
  tm_scalebar(position = c("left", "bottom"))+
  tm_title("Gender Inequality Index Difference between 2010-2019", 
            size = 2,
            position = c("center", "top"))
```
